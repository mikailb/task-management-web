<!DOCTYPE html>
<html lang="no" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} + ' - Oppgavebehandlingssystem'">Oppgaver - Oppgavebehandlingssystem</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-tasks me-2"></i>Oppgavebehandlingssystem
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/add-task">
                <i class="fas fa-plus me-1"></i>Ny oppgave
            </a>
            <a class="nav-link" href="/">
                <i class="fas fa-home me-1"></i>Hjem
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 th:text="${pageTitle}">Oppgaver</h2>
            <p class="text-muted mb-0">
                <span th:text="${tasks.size()}">0</span> oppgave(r) funnet
            </p>
        </div>
        <div>
            <a href="/" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left me-1"></i>Alle oppgaver
            </a>
            <a href="/add-task" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Ny oppgave
            </a>
        </div>
    </div>

    <!-- Filter Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/" class="text-decoration-none">
                    <i class="fas fa-home me-1"></i>Hjem
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${pageTitle}">Filtrerte oppgaver</li>
        </ol>
    </nav>

    <!-- Quick Filters -->
    <div class="row mb-4">
        <div class="col">
            <div class="btn-group flex-wrap" role="group" aria-label="Hurtigfiltre">
                <a href="/" class="btn btn-outline-primary">
                    <i class="fas fa-list me-1"></i>Alle
                </a>
                <a href="/upcoming" class="btn btn-outline-warning">
                    <i class="fas fa-clock me-1"></i>Kommende
                </a>
                <a href="/priority/HIGH" class="btn btn-outline-danger">
                    <i class="fas fa-exclamation me-1"></i>H√∏y
                </a>
                <a href="/priority/MEDIUM" class="btn btn-outline-warning">
                    <i class="fas fa-minus me-1"></i>Medium
                </a>
                <a href="/priority/LOW" class="btn btn-outline-success">
                    <i class="fas fa-arrow-down me-1"></i>Lav
                </a>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div th:if="${tasks.empty}" class="empty-state">
        <i class="fas fa-search"></i>
        <h4>Ingen oppgaver funnet</h4>
        <p class="text-muted mb-4">Det finnes ingen oppgaver som matcher dette filteret.</p>
        <div>
            <a href="/" class="btn btn-outline-primary me-2">
                <i class="fas fa-list me-1"></i>Se alle oppgaver
            </a>
            <a href="/add-task" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Legg til oppgave
            </a>
        </div>
    </div>

    <!-- Tasks Grid -->
    <div th:if="${!tasks.empty}" class="row">
        <div th:each="task : ${tasks}" class="col-lg-6 col-xl-4 mb-4">
            <div class="card task-card h-100"
                 th:classappend="${task.completed} ? 'completed' : (${task.overdue} ? 'overdue' : '')"
                 th:data-priority="${task.priority.name().toLowerCase()}">

                <div class="card-body" th:classappend="'priority-' + ${task.priority.name().toLowerCase()}">
                    <!-- Task Header -->
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h6 class="card-title mb-0 me-2" th:text="${task.title}">Oppgavetittel</h6>
                        <span class="badge"
                              th:classappend="${task.priority.name() == 'HIGH'} ? 'bg-danger' : (${task.priority.name() == 'MEDIUM'} ? 'bg-warning text-dark' : 'bg-success')"
                              th:text="${task.priority.displayName}">Prioritet</span>
                    </div>

                    <!-- Task Description -->
                    <p class="card-text text-muted small mb-3" th:text="${task.description}">Beskrivelse</p>

                    <!-- Task Type Info -->
                    <div class="mb-3">
                        <div th:if="${task.class.simpleName == 'WorkTask'}" class="small text-primary">
                            <i class="fas fa-briefcase me-1"></i>
                            <strong>Jobboppgave</strong>
                            <div class="mt-1">
                                <span th:if="${!#strings.isEmpty(task.project)}" th:text="'üìÅ ' + ${task.project}"></span>
                                <span th:if="${!#strings.isEmpty(task.client)}" class="d-block" th:text="'üë§ ' + ${task.client}"></span>
                                <span th:if="${!#strings.isEmpty(task.department)}" class="d-block" th:text="'üè¢ ' + ${task.department}"></span>
                            </div>
                        </div>

                        <div th:if="${task.class.simpleName == 'PersonalTask'}" class="small text-success">
                            <i class="fas fa-user me-1"></i>
                            <strong>Personlig oppgave</strong>
                            <div class="mt-1">
                                <span th:text="'üìù ' + ${task.category}"></span>
                                <span th:if="${!#strings.isEmpty(task.location)}" class="d-block" th:text="'üìç ' + ${task.location}"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Task Meta Info -->
                    <div class="small text-muted mb-3">
                        <div class="d-flex justify-content-between">
                                <span>
                                    <i class="fas fa-calendar me-1"></i>
                                    <span th:text="${task.formattedDueDate}">Dato</span>
                                </span>
                            <span th:if="${task.overdue}" class="text-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Forfalt
                                </span>
                            <span th:if="${task.completed}" class="text-success">
                                    <i class="fas fa-check-circle me-1"></i>Fullf√∏rt
                                </span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between">
                        <div class="btn-group btn-group-sm">
                            <a th:href="@{/edit-task/{id}(id=${task.id})}"
                               class="btn btn-outline-primary"
                               title="Rediger">
                                <i class="fas fa-edit"></i>
                            </a>

                            <form th:if="${!task.completed}"
                                  th:action="@{/complete-task/{id}(id=${task.id})}"
                                  method="post" class="d-inline">
                                <button type="submit"
                                        class="btn btn-outline-success"
                                        title="Fullf√∏r">
                                    <i class="fas fa-check"></i>
                                </button>
                            </form>
                        </div>

                        <form th:action="@{/delete-task/{id}(id=${task.id})}"
                              method="post" class="d-inline">
                            <button type="submit"
                                    class="btn btn-outline-danger btn-sm btn-delete"
                                    title="Slett">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Progress indicator for overdue tasks -->
                <div th:if="${task.overdue and !task.completed}"
                     class="card-footer bg-danger text-white text-center py-2">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        Oppgaven har forfalt
                    </small>
                </div>

                <!-- Completion indicator -->
                <div th:if="${task.completed}"
                     class="card-footer bg-success text-white text-center py-2">
                    <small>
                        <i class="fas fa-check-circle me-1"></i>
                        Fullf√∏rt oppgave
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to top button for long lists -->
    <div th:if="${tasks.size() > 6}" class="text-center mt-4">
        <button onclick="window.scrollTo(0, 0)" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-up me-1"></i>Tilbake til toppen
        </button>
    </div>
</div>

<!-- Floating Action Button -->
<a href="/add-task" class="btn btn-primary btn-floating">
    <i class="fas fa-plus fa-lg"></i>
</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="/js/app.js"></script>
</body>
</html>